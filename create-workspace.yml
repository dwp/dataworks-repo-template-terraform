---
platform: linux
image_resource:
  type: docker-image
  source:
    repository: ((dataworks.terraform_repository))
    tag: ((dataworks.terraform_version))
params:
  TF_INPUT: false
  TF_CLI_ARGS_apply: -lock-timeout=300s
  TF_CLI_ARGS_plan: -lock-timeout=300s
  TF_VAR_costcode: ((dataworks.costcode))
  WORKSPACE: ((workspace))
inputs:
  - name: repo
run:
  path: sh
  args:
    - -exc
    - |
      echo "Creating workspace $WORKSPACE"
      terraform workspace new $WORKSPACE
