jobs:
  - name: dataworks-repo-template-terraform
    plan:
      - get: dataworks-repo-template-terraform-pr
        trigger: true
        version: every
      - put: dataworks-repo-template-terraform-pr
        params:
          path: dataworks-repo-template-terraform-pr
          status: pending
        input_mapping:
          dataworks-repo-template-terraform: dataworks-repo-template-terraform-pr
      - task: basic-git-test
        config:
          platform: linux
          image_resource:
            type: docker-image
            source: { repository: alpine/git, tag: "latest" }
          inputs:
            - name: dataworks-repo-template-terraform-pr
          run:
            path: /bin/sh
            args:
              - -xce
              - |
                cd dataworks-repo-template-terraform-pr
                git log --graph --all --color --pretty=format:"%x1b[31m%h%x09%x1b[32m%d%x1b[0m%x20%s" > log.txt
                cat log.txt
        on_failure:
          put: dataworks-repo-template-terraform-pr
          params:
            path: dataworks-repo-template-terraform-pr
            status: failure
        on_success:
          put: dataworks-repo-template-terraform-pr
          params:
            path: dataworks-repo-template-terraform-pr
            status: success
